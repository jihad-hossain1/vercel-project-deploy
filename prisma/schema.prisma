generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Enums
enum MovementType {
  IN
  OUT
}

// Logs table
model logs {
  id       Int     @id @default(autoincrement())
  logType  String  @db.VarChar(50)
  message  String  @db.Text
  details  String? @db.Text
  context  Json?
  source   String? @db.VarChar(100)
  metadata Json?

  createdAt DateTime @default(now()) @db.Timestamp(0)

  @@index([logType], map: "log_type_idx")
  @@index([createdAt], map: "created_at_idx")
  @@map("logs")
}

// Temp table
model temp {
  id        Int      @id @default(autoincrement())
  jsonData  Json?
  code      String   @db.VarChar(100)
  email     String   @db.VarChar(255)
  createdAt DateTime @default(now()) @db.Timestamp(0)
  updatedAt DateTime @default(now()) @db.Timestamp(0)
  type      String   @default("email_verify") @db.VarChar(50)

  @@map("temp")
}

// Business table
model business {
  id             Int      @id @default(autoincrement())
  email          String   @unique @db.VarChar(255)
  mobile         String?  @db.VarChar(20)
  isActive       Boolean  @default(false)
  createdAt      DateTime @default(now()) @db.Timestamp(0)
  updatedAt      DateTime @default(now()) @db.Timestamp(0)
  isStockManaged Boolean  @default(false)

  // Relations
  users           users[]
  userProfiles    user_profile[]
  customers       customers[]
  items           items[]
  employees       employees[]
  departments     departments[]
  invoiceMasters  invoice_master[]
  purchaseClients purchase_client[]
  purchases       purchases[]
  purchaseDetails purchase_detail[]
  codes           codes[]
  codeTypes       code_type[]
  stockMovements  stock_movements[]
  currentStocks   current_stock[]
  businessStats   business_stats?

  @@map("business")
}

// Users table
model users {
  id         Int      @id @default(autoincrement())
  email      String   @unique @db.VarChar(255)
  username   String   @db.VarChar(100)
  password   String   @db.Text
  mobile     String?  @db.VarChar(20)
  firstName  String?  @db.VarChar(100)
  lastName   String?  @db.VarChar(100)
  isActive   Boolean  @default(false)
  createdAt  DateTime @default(now()) @db.Timestamp(0)
  updatedAt  DateTime @default(now()) @db.Timestamp(0)
  businessId Int

  // Relations
  business       business          @relation(fields: [businessId], references: [id])
  profile        user_profile?
  invoiceMasters invoice_master[]
  purchases      purchases[]
  stockMovements stock_movements[]
  currentStocks  current_stock[]

  @@map("users")
}

// User Profile table
model user_profile {
  id            Int      @id @default(autoincrement())
  address       String?  @db.Text
  avatar        String?  @db.VarChar(256)
  organization  String?  @db.VarChar(50)
  contactNumber String?  @db.VarChar(20)
  contactEmail  String?  @db.VarChar(100)
  website       String?  @db.VarChar(150)
  country       String?  @db.VarChar(50)
  state         String?  @db.VarChar(50)
  city          String?  @db.VarChar(50)
  about         String?  @db.VarChar(500)
  createdAt     DateTime @default(now()) @db.Timestamp(0)
  updatedAt     DateTime @default(now()) @db.Timestamp(0)
  businessId    Int
  userId        Int      @unique

  // Relations
  business business @relation(fields: [businessId], references: [id])
  user     users    @relation(fields: [userId], references: [id])

  @@map("user_profile")
}

// Customers table
model customers {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(255)
  email      String   @db.VarChar(255)
  phone      String?  @db.VarChar(20)
  cusCode    String   @db.VarChar(50)
  address    String?  @db.Text
  city       String?  @db.VarChar(100)
  state      String?  @db.VarChar(100)
  country    String?  @db.VarChar(100)
  postalCode String?  @db.VarChar(20)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now()) @db.Timestamp(0)
  updatedAt  DateTime @default(now()) @db.Timestamp(0)
  businessId Int

  // Relations
  business business @relation(fields: [businessId], references: [id])

  @@unique([businessId, cusCode], map: "unique_business_cus_code")
  @@map("customers")
}

// Departments table
model departments {
  id         Int      @id @default(autoincrement())
  name       String   @unique @db.VarChar(100)
  deptCode   String   @db.VarChar(50)
  businessId Int
  createdAt  DateTime @default(now()) @db.Timestamp(0)
  updatedAt  DateTime @default(now()) @db.Timestamp(0)

  // Relations
  business  business    @relation(fields: [businessId], references: [id])
  employees employees[]

  @@unique([businessId, deptCode], map: "unique_business_dept_code")
  @@map("departments")
}

// Employees table
model employees {
  id             Int      @id @default(autoincrement())
  userName       String   @db.VarChar(100)
  email          String   @db.VarChar(255)
  empCode        String   @db.VarChar(50)
  businessId     Int
  password       String   @db.VarChar(255)
  mobile         String?  @db.VarChar(20)
  departmentId   Int?
  departmentName String   @db.VarChar(100)
  hireDate       DateTime @db.Date
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now()) @db.Timestamp(0)
  updatedAt      DateTime @default(now()) @db.Timestamp(0)
  rolePermission Json?

  // Relations
  business   business     @relation(fields: [businessId], references: [id])
  department departments? @relation(fields: [departmentId], references: [id])

  @@unique([businessId, email], map: "unique_business_employee_email")
  @@map("employees")
}

// Items table
model items {
  id            Int      @id @default(autoincrement())
  name          String   @db.VarChar(255)
  description   String?  @db.Text
  proCode       String?  @db.VarChar(50)
  sku           String?  @db.VarChar(50)
  category      String   @db.VarChar(100)
  catId         Int
  unitPrice     Decimal  @default(0) @db.Decimal(10, 2)
  costPrice     Decimal  @default(0) @db.Decimal(10, 2)
  stockQuantity Decimal? @default(0) @db.Decimal(10, 2)
  minStockLevel Decimal? @default(0) @db.Decimal(10, 2)
  unit          String   @default("pcs") @db.VarChar(20)
  taxRate       Decimal? @default(0) @db.Decimal(10, 2)
  discountRate  Decimal? @default(0) @db.Decimal(10, 2)
  image         String   @default("") @db.VarChar(256)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now()) @db.Timestamp(0)
  updatedAt     DateTime @default(now()) @db.Timestamp(0)
  businessId    Int

  // Relations
  business        business          @relation(fields: [businessId], references: [id])
  invoiceDetails  invoice_detail[]
  purchaseDetails purchase_detail[]
  stockMovements  stock_movements[]
  currentStocks   current_stock[]

  @@unique([businessId, proCode], map: "unique_business_pro_code")
  @@map("items")
}

// Invoice Master table
model invoice_master {
  id              Int       @id @default(autoincrement())
  invoiceNumber   String    @db.VarChar(50)
  customerId      Int?
  customerPhone   String    @db.VarChar(20)
  customerName    String?   @db.VarChar(100)
  customerEmail   String?   @db.VarChar(100)
  customerAddress String?   @db.VarChar(255)
  businessId      Int
  invoiceDate     DateTime? @db.Timestamp(0)
  dueDate         DateTime? @db.Timestamp(0)
  subtotal        Decimal   @default(0) @db.Decimal(10, 2)
  dueAmount       Decimal?  @default(0) @db.Decimal(10, 2)
  tax             Decimal?  @default(0) @db.Decimal(10, 2)
  discount        Decimal?  @default(0) @db.Decimal(10, 2)
  deliveryCharge  Decimal?  @default(0) @db.Decimal(10, 2)
  totalAmount     Decimal   @default(0) @db.Decimal(10, 2)
  status          String    @default("unpaid") @db.VarChar(20)
  notes           String?   @db.Text
  createdAt       DateTime  @default(now()) @db.Timestamp(0)
  updatedAt       DateTime  @default(now()) @db.Timestamp(0)
  createdBy       Int
  paymentInfo     Json?

  // Relations
  business       business         @relation(fields: [businessId], references: [id])
  createdByUser  users            @relation(fields: [createdBy], references: [id])
  invoiceDetails invoice_detail[]

  @@unique([businessId, invoiceNumber], map: "unique_business_invoice_number")
  @@map("invoice_master")
}

// Invoice Details table
model invoice_detail {
  id              Int      @id @default(autoincrement())
  invoiceMasterId Int
  itemId          Int
  businessId      Int
  itemName        String   @db.VarChar(255)
  description     String?  @db.Text
  quantity        Decimal  @default(0) @db.Decimal(10, 2)
  unitPrice       Decimal  @default(0) @db.Decimal(10, 2)
  lineTotal       Decimal  @default(0) @db.Decimal(10, 2)
  tax             Decimal? @default(0) @db.Decimal(10, 2)
  discount        Decimal? @default(0) @db.Decimal(10, 2)
  createdAt       DateTime @default(now()) @db.Timestamp(0)
  updatedAt       DateTime @default(now()) @db.Timestamp(0)

  // Relations
  invoiceMaster invoice_master @relation(fields: [invoiceMasterId], references: [id])
  item          items          @relation(fields: [itemId], references: [id])

  @@map("invoice_detail")
}

// Purchase Clients table
model purchase_client {
  id            Int      @id @default(autoincrement())
  name          String   @db.VarChar(255)
  email         String   @db.VarChar(255)
  phone         String?  @db.VarChar(20)
  address       String?  @db.Text
  city          String?  @db.VarChar(100)
  state         String?  @db.VarChar(100)
  country       String?  @db.VarChar(100)
  postalCode    String?  @db.VarChar(20)
  contactPerson String?  @db.VarChar(255)
  taxId         String?  @db.VarChar(50)
  paymentTerms  String?  @db.VarChar(100)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now()) @db.Timestamp(0)
  updatedAt     DateTime @default(now()) @db.Timestamp(0)
  businessId    Int

  // Relations
  business  business    @relation(fields: [businessId], references: [id])
  purchases purchases[]

  @@unique([businessId, email], map: "unique_business_email")
  @@map("purchase_client")
}

// Purchases table
model purchases {
  id                   Int      @id @default(autoincrement())
  purchaseNumber       String   @db.VarChar(50)
  supplierId           Int
  supplierName         String   @db.VarChar(100)
  supplierEmail        String   @db.VarChar(100)
  supplierAddress      String?  @db.VarChar(255)
  supplierPhone        String?  @db.VarChar(20)
  businessId           Int
  purchaseDate         DateTime @default(now()) @db.Timestamp(0)
  expectedDeliveryDate DateTime @default(now()) @db.Timestamp(0)
  actualDeliveryDate   DateTime @default(now()) @db.Timestamp(0)
  subtotal             Decimal  @default(0) @db.Decimal(10, 2)
  taxAmount            Decimal? @default(0) @db.Decimal(10, 2)
  discountAmount       Decimal? @default(0) @db.Decimal(10, 2)
  shippingCost         Decimal? @default(0) @db.Decimal(10, 2)
  totalAmount          Decimal  @default(0) @db.Decimal(10, 2)
  status               String   @default("pending") @db.VarChar(20)
  paymentStatus        String   @default("unpaid") @db.VarChar(20)
  notes                String?  @db.Text
  createdAt            DateTime @default(now()) @db.Timestamp(0)
  updatedAt            DateTime @default(now()) @db.Timestamp(0)
  createdBy            Int

  // Relations
  supplier        purchase_client   @relation(fields: [supplierId], references: [id])
  business        business          @relation(fields: [businessId], references: [id])
  createdByUser   users             @relation(fields: [createdBy], references: [id])
  purchaseDetails purchase_detail[]

  @@unique([businessId, purchaseNumber], map: "unique_business_purchase_number")
  @@map("purchases")
}

// Purchase Details table
model purchase_detail {
  id               Int      @id @default(autoincrement())
  purchaseId       Int
  itemId           Int
  businessId       Int
  itemName         String   @db.VarChar(255)
  quantity         Int      @default(0)
  unitCost         Decimal? @db.Decimal(10, 2)
  unitPrice        Decimal? @db.Decimal(10, 2)
  lineTotal        Decimal  @default(0) @db.Decimal(10, 2)
  receivedQuantity Decimal  @default(0) @db.Decimal(10, 2)
  createdAt        DateTime @default(now()) @db.Timestamp(0)
  updatedAt        DateTime @default(now()) @db.Timestamp(0)

  // Relations
  purchase purchases @relation(fields: [purchaseId], references: [id])
  item     items     @relation(fields: [itemId], references: [id])
  business business  @relation(fields: [businessId], references: [id])

  @@map("purchase_detail")
}

// Code Type table
model code_type {
  id         Int    @id @default(autoincrement())
  codeType   String @db.VarChar(50)
  businessId Int

  // Relations
  business business @relation(fields: [businessId], references: [id])

  @@map("code_type")
}

// Codes table
model codes {
  id         Int      @id @default(autoincrement())
  businessId Int
  codeType   String   @db.VarChar(50)
  codeName   String   @db.VarChar(50)
  codeDesc   String?  @db.VarChar(150)
  longDesc   Json?
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now()) @db.Timestamp(0)
  updatedAt  DateTime @default(now()) @db.Timestamp(0)

  // Relations
  business business @relation(fields: [businessId], references: [id])

  @@unique([businessId, codeName], map: "unique_business_code_name")
  @@map("codes")
}

// Stock Movements table
model stock_movements {
  id           Int          @id @default(autoincrement())
  businessId   Int
  userId       Int
  itemId       Int
  purchaseId   Int?
  saleId       Int?
  movementType MovementType
  refId        Int?
  qty          Decimal      @default(0) @db.Decimal(10, 2)
  movementDate DateTime     @default(now()) @db.Timestamp(0)

  // Relations
  business business @relation(fields: [businessId], references: [id])
  user     users    @relation(fields: [userId], references: [id])
  item     items    @relation(fields: [itemId], references: [id])

  @@map("stock_movements")
}

// Current Stock table
model current_stock {
  id         Int     @id @default(autoincrement())
  businessId Int
  userId     Int
  itemId     Int?
  qty        Decimal @default(0) @db.Decimal(10, 2)

  // Relations
  business business @relation(fields: [businessId], references: [id])
  user     users    @relation(fields: [userId], references: [id])
  item     items?   @relation(fields: [itemId], references: [id])

  @@unique([itemId], map: "unique_product_id")
  @@map("current_stock")
}

// Business Stats table
model business_stats {
  id         Int @id @default(autoincrement())
  businessId Int @unique
  customers  Int @default(0)
  items      Int @default(0)
  employees  Int @default(0)
  invoices   Int @default(0)
  purchases  Int @default(0)
  suppliers  Int @default(0)

  // Relations
  business business @relation(fields: [businessId], references: [id])

  @@map("business_stats")
}

model collections {
  id         Int      @id @default(autoincrement())
  type       String   @default("customer") @db.VarChar(20)
  moveType   String   @default("in") @db.VarChar(10)
  amount     Decimal  @default(0) @db.Decimal(10, 2)
  customerId Int?
  supplierId Int?
  businessId Int
  createdAt  DateTime @default(now()) @db.Timestamp(0)
  updatedAt  DateTime @default(now()) @db.Timestamp(0)

  @@index([businessId], map: "business_id_idx")
  @@map("collections")
}
